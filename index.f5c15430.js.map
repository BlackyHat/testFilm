{"mappings":"qhBAAA,IAAAA,EAAAC,EAAA,S,KCCAC,OAAOC,eAAeC,EAAS,aAAc,CACzCC,OAAO,IAEXD,EAAQE,QACR,SAAyBC,EAAKC,EAAKH,GAC3BG,KAAOD,EACPL,OAAOC,eAAeI,EAAKC,EAAK,CAC5BH,MAAOA,EACPI,YAAY,EACZC,cAAc,EACdC,UAAU,IAGdJ,EAAIC,GAAOH,EAEf,OAAOE,C,EDZX,MAAMK,EAAkB,IAAI,EAAAZ,EAAAa,iBACtBC,EAAW,IELV,MAOLC,cACMC,SAASC,cAAc,eAI3BD,SAASC,cAAc,QAAQC,mBAC7B,YACA,0LAQFC,KAAKC,MAAQJ,SAASC,cAAc,aACpCE,KAAKE,SAAWL,SAASC,cAAc,kB,CAtBzCK,cAyBAC,EAAAnB,EAAA,CAAAe,KAAA,2BAA0B,KACxBA,KAAKC,MAAMI,iBAAiB,SAASC,KAC/BA,EAAEC,OAAOC,UAAUC,SAAS,aAErBH,EAAEC,OAAOC,UAAUC,SAAS,iBADrCT,KAAKU,YAEY,GAEnB,IAGJN,EAAAnB,EAAA,CAAAe,KAAA,yBAAwB,KACtBH,SAASQ,iBAAiB,UAAWL,KAAKW,WAAW,IAGvDP,EAAAnB,EAAA,CAAAe,KAAA,cAAaM,IACI,WAAXA,EAAEM,OACJZ,KAAKU,aACLb,SAASgB,oBAAoB,UAAWb,KAAKW,Y,IAGjDP,EAAAnB,EAAA,CAAAe,KAAA,cAAa,KACXA,KAAKC,MAAMa,QAAQ,IA7CnBd,KAAKe,cAAgB,GACrBf,KAAKE,SAAW,GAChBF,KAAKC,MAAQ,E,GFES,IGNnB,MACLE,cAEAC,EAAAnB,EAAA,CAAAe,KAAA,cAAagB,IACX,IACE,MAAMC,EAAQC,aAAaC,QAAQH,GAC7BI,EAAKC,KAAKC,MAAML,GACtB,OAAOG,GAAU,E,CACjB,MAAOG,GACPC,QAAQC,IAAIF,E,KAGhBnB,EAAAnB,EAAA,CAAAe,KAAA,cAAa,CAACgB,EAAWU,KACvBR,aAAaS,QAAQX,EAAWU,EAChC,IAIFtB,EAAAnB,EAAA,CAAAe,KAAA,QAAO,CAACX,EAAKH,KACX,IACE,MAAM0C,EAAkBP,KAAKQ,UAAU3C,GACvCgC,aAAaS,QAAQtC,EAAKuC,E,CAC1B,MAAOL,GACPC,QAAQD,MAAM,oBAAqBA,EAAMO,Q,KAI7C1B,EAAAnB,EAAA,CAAAe,KAAA,QAAOX,IACL,IACE,MAAMuC,EAAkBV,aAAaC,QAAQ9B,GAC7C,OAA2B,OAApBuC,OAA2BG,EAAYV,KAAKC,MAAMM,E,CACzD,MAAOL,GACPC,QAAQD,MAAM,oBAAqBA,EAAMO,Q,OHxB/C,IAAIE,EAAc,GAClB,MACMC,EAAO,CACXC,QAASrC,SAASC,cAAc,YAChCqC,QAAStC,SAASC,cAAc,aAGlCmC,EAAKC,QAAQ7B,iBAAiB,SAE9B,SAA4B+B,GAE1B,GADAA,EAAEC,iBACED,EAAE7B,OAAO+B,QAAQ,oBAAqB,CACxC,MAAMC,EAAYH,EAAE7B,OAAO+B,QAAQ,MAEnC3C,EAASC,cACTD,EAAS6C,0BACT7C,EAAS8C,wBACThD,EAAgBiD,QAAUH,EAAUI,GAyEtClD,EAAgBmD,aAAaC,MAAKC,IAC3BA,GAUT,SAAoBA,GAClB,MAAMC,eACJA,EAAcC,YACdA,EAAWC,MACXA,EAAKC,aACLA,EAAYC,WACZA,EAAUC,SACVA,EAAQC,OACRA,EAAMC,WACNA,EAAUX,GACVA,GACEG,EAEJd,EAAc,C,eACZe,E,GACAJ,E,YACAK,E,MACAC,E,aACAC,E,WACAC,E,SACAC,E,OACAC,E,WACAC,GAGF,MAAMC,EAAS,gFA7HC,mCAgIAP,WACJC,2CACuBA,klBAkByBC,EAAaM,QACjE,mCACgCL,EAAWK,uGAGVF,EAAWE,QAAQ,+FAGbT,wFAGNM,EAAO,GAAGI,qIAMdL,kTASrCzD,EAASO,SAASwD,WAAaH,C,CAjF7BI,CAAWb,EAAK,IA3EhBb,EAAK/B,SAAWL,SAASC,cAAc,kBAGvCmC,EAAK/B,SAASG,iBAAiB,SAASC,IAC1BA,EAAEC,OACNqD,QACN,G","sources":["src/js/details_modal.js","node_modules/@swc/helpers/lib/_define_property.js","src/js/pure_modal.js","src/js/localStorage.js"],"sourcesContent":["import { FilmsApiService } from './search-api';\nimport { ModalBox } from './pure_modal';\nimport { FilmsLocalStorage } from './localStorage';\n\nconst filmsApiService = new FilmsApiService();\nconst modalBox = new ModalBox();\nconst filmsLocalStorage = new FilmsLocalStorage();\n\nlet currentCard = {};\nconst IMAGE_URL = 'https://image.tmdb.org/t/p/w500/';\nconst refs = {\n  gallery: document.querySelector('.gallery'),\n  spinner: document.querySelector('.loading'),\n};\n\nrefs.gallery.addEventListener('click', onGalleryItemClick);\n\nfunction onGalleryItemClick(e) {\n  e.preventDefault();\n  if (e.target.closest('li.gallery__item')) {\n    const elementId = e.target.closest('li');\n    // refs.spinner.classList.remove('visually-hidden');\n    modalBox.createModal();\n    modalBox.addListenerOnClickClose();\n    modalBox.addListenerOnKeyClose();\n    filmsApiService.movieId = elementId.id;\n    getFilmInfo();\n    refs.modalBox = document.querySelector('.js-modal__box');\n    //\n    // ACTIVE BUTTONS\n    refs.modalBox.addEventListener('click', e => {\n      const btn = e.target;\n      if (btn.nodeName !== 'BUTTON') {\n        return;\n      }\n      //================================LOCAL_STORAGE=============\n      // const action = btn.dataset.action;\n      // const db = filmsLocalStorage.load(action);\n      // //\n      // const isWatched = db ? db.find(film => film.id === currentCard.id) : 0;\n      // //\n      // console.log(isWatched);\n      // if (!isWatched) {\n      //   db.push(currentCard);\n      //   filmsLocalStorage.save(action, db);\n      // } else {\n      //   const indexFilm = db.indexOf(isWatched);\n      //   db.splice(isWatched, 1);\n      //   filmsLocalStorage.save(action, db);\n      // }\n      // console.log(JSON.stringify(db));\n    });\n    //   btn.dataset.action === 'watched'\n    //     ? addWatched(currentCard)\n    //     : addQueue(currentCard);\n    // });\n    // refs.gallery.removeEventListener('click', onGalleryItemClick);\n  }\n}\n\nfunction addWatched(info) {\n  localStorage.setItem('watched', JSON.stringify(info));\n}\nfunction addQueue(info) {\n  localStorage.setItem('queque', JSON.stringify(info));\n}\n// function onGalleryItemClick(e) {\n//   e.preventDefault();\n//   if (e.target.closest('li')) {\n//     const elementId = e.target.closest('li');\n//     // refs.spinner.classList.remove('visually-hidden');\n//     createModal();\n//     addListenerOnClickClose();\n//     addListenerOnKeyClose();\n//     filmsApiService.movieId = elementId.id;\n//     getFilmInfo();\n//     refs.gallery.removeEventListener('click', onGalleryItemClick);\n//   }\n// }\n\n// function createModal() {\n//   if (document.querySelector('.js-modal')) {\n//     return;\n//   }\n//   refs.gallery.insertAdjacentHTML(\n//     'beforeend',\n//     `<div class=\"js-modal modal\">\n//         <div class=\"js-modal__box modal__box\">\n\n//         </div>\n//       </div >`\n//   );\n//   refs.modal = document.querySelector('.js-modal');\n//   refs.modalBox = document.querySelector('.js-modal__box');\n// }\n\n//====================================================================\nfunction getFilmInfo() {\n  filmsApiService.getInfoApi().then(data => {\n    if (!data) {\n      return;\n    }\n    makeMarkup(data);\n    // refs.spinner.classList.add('visually-hidden');\n  });\n}\n\n//====================================================================\n\nfunction makeMarkup(data) {\n  const {\n    original_title,\n    poster_path,\n    title,\n    vote_average,\n    vote_count,\n    overview,\n    genres,\n    popularity,\n    id,\n  } = data;\n\n  currentCard = {\n    original_title,\n    id,\n    poster_path,\n    title,\n    vote_average,\n    vote_count,\n    overview,\n    genres,\n    popularity,\n  };\n\n  const markup = `\n      <div class=\"film-detail\">\n    <img class=\"film-detail__poster\" src=\"${\n      IMAGE_URL + poster_path\n    }\" alt=\"${title}\">\n    <h3 class=\"film-detail__title\">${title}</h3>\n    <div class=\"film-detail__info\">\n    <ul class=\"film-detail__labels list\">\n        <li>\n            <p class=\"film-detail__label\">Vote / Votes</p>\n            </li>\n            <li>\n            <p class=\"film-detail__label\">Popularity</p>\n            </li>\n            <li>\n            <p class=\"film-detail__label\">Original Title</p>\n            </li>\n            <li>\n            <p class=\"film-detail__label\">Genre</p>\n        </li>\n    </ul>\n        <ul class=\"film-detail__data list\">\n        <li>\n        <p class=\"film-detail__meta del\"><span class=\"vote\">${vote_average.toFixed(\n          1\n        )}</span> / <span class=\"votes\">${vote_count.toFixed()}</span></p>\n            </li>\n            <li>\n            <p class=\"film-detail__meta\">${popularity.toFixed(1)}</p>\n            </li>\n            <li>\n            <p class=\"film-detail__meta title\">${original_title}</p>\n            </li>\n            <li>\n            <p class=\"film-detail__meta\">${genres[0].name}</p>\n        </li>\n    </ul>\n</div>\n\n    <h4 class=\"film-detail__about\">ABOUT</h4>\n    <p class=\"film-detail__overview\">${overview}</p>\n    <ul class=\"film-detail buttons\">\n        <li><button type=\"button\" class=\"film-detail__link\" data-action=\"watched\">add to Watched</button>\n        </li>\n        <li><button  type=\"button\" class=\"film-detail__link\" data-action=\"queue\">add to queue</button>\n        </li>\n    </ul>\n</div>`;\n\n  modalBox.modalBox.innerHTML += markup;\n}\n\n//====================================================================\n// function closeModal() {\n//   refs.gallery.addEventListener('click', onGalleryItemClick);\n//   refs.modal.remove();\n// }\n// function addListenerOnClickClose() {\n//   refs.modal.addEventListener('click', e => {\n//     if (e.target.classList.contains('js-modal')) {\n//       closeModal();\n//     } else if (e.target.classList.contains('modal__icon')) {\n//       closeModal();\n//     }\n//   });\n// }\n\n// function addListenerOnKeyClose() {\n//   document.addEventListener('keydown', onKeyClose);\n// }\n\n// function onKeyClose(e) {\n//   if (e.code === 'Escape') {\n//     closeModal();\n//     document.removeEventListener('keydown', onKeyClose);\n//   }\n// }\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = _defineProperty;\nfunction _defineProperty(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\n","export class ModalBox {\n  constructor() {\n    this.modalBackdrop = '';\n    this.modalBox = '';\n    this.modal = '';\n  }\n\n  createModal() {\n    if (document.querySelector('.js-modal')) {\n      return;\n    }\n    //\n    document.querySelector('main').insertAdjacentHTML(\n      'beforeend',\n      `<div class=\"js-modal modal\">\n        <div class=\"js-modal__box modal__box\">\n          <button class=\"modal__icon link button\">\n            </button>\n        </div>\n      </div >`\n    );\n    //\n    this.modal = document.querySelector(`.js-modal`);\n    this.modalBox = document.querySelector('.js-modal__box');\n  }\n\n  addListenerOnClickClose = () => {\n    this.modal.addEventListener('click', e => {\n      if (e.target.classList.contains('js-modal')) {\n        this.closeModal();\n      } else if (e.target.classList.contains('modal__icon')) {\n        this.closeModal();\n      }\n    });\n  };\n\n  addListenerOnKeyClose = () => {\n    document.addEventListener('keydown', this.onKeyClose);\n  };\n\n  onKeyClose = e => {\n    if (e.code === 'Escape') {\n      this.closeModal();\n      document.removeEventListener('keydown', this.onKeyClose);\n    }\n  };\n  closeModal = () => {\n    this.modal.remove();\n  };\n}\n","export class FilmsLocalStorage {\n  constructor() {}\n\n  getStorage = queryType => {\n    try {\n      const local = localStorage.getItem(queryType);\n      const db = JSON.parse(local);\n      return db ? db : [];\n    } catch (error) {\n      console.log(error);\n    }\n  };\n  setStorage = (queryType, filmsArr) => {\n    localStorage.setItem(queryType, filmsArr);\n    return;\n  };\n\n  //////////////////////////////////////////////////////////////////////\n  save = (key, value) => {\n    try {\n      const serializedState = JSON.stringify(value);\n      localStorage.setItem(key, serializedState);\n    } catch (error) {\n      console.error('Set state error: ', error.message);\n    }\n  };\n\n  load = key => {\n    try {\n      const serializedState = localStorage.getItem(key);\n      return serializedState === null ? undefined : JSON.parse(serializedState);\n    } catch (error) {\n      console.error('Get state error: ', error.message);\n    }\n  };\n}\n"],"names":["$arR5w","parcelRequire","Object","defineProperty","$da4b248c00322402$exports","value","default","obj","key","enumerable","configurable","writable","$c8e3c98155229a50$var$filmsApiService","FilmsApiService","$c8e3c98155229a50$var$modalBox","createModal","document","querySelector","insertAdjacentHTML","this","modal","modalBox","constructor","$parcel$interopDefault","addEventListener","e","target","classList","contains","closeModal","onKeyClose","code","removeEventListener","remove","modalBackdrop","queryType","local","localStorage","getItem","db","JSON","parse","error","console","log","filmsArr","setItem","serializedState","stringify","message","undefined","$c8e3c98155229a50$var$currentCard","$c8e3c98155229a50$var$refs","gallery","spinner","e1","preventDefault","closest","elementId","addListenerOnClickClose","addListenerOnKeyClose","movieId","id","getInfoApi","then","data","original_title","poster_path","title","vote_average","vote_count","overview","genres","popularity","markup","toFixed","name","innerHTML","$c8e3c98155229a50$var$makeMarkup","nodeName"],"version":3,"file":"index.f5c15430.js.map"}